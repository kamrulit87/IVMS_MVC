@model DAL.db.OrganizationCore
@{
    ViewBag.Title = "Organization Information";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section section_top
{
<link href="~/Content/built_in/assets/plugins/bootstrap-select2/select2.css" rel="stylesheet" />
<link href="~/Content/built_in/assets/plugins/bootstrap-datepicker/css/datepicker3.css" rel="stylesheet" /> 
}

<div class="container-fluid container-fixed-lg">
    <div class="panel panel-transparent">
        <div class="panel-heading">
            <div class="panel-title">
                organization information
            </div>
        </div>
        <div class="panel-body">

            @using (Html.BeginForm("frmorganization", "mstr_basic", FormMethod.Post, new { enctype = "multipart/form-data", @id = "form-work", @class = "form-horizontal xl-mlr10", role = "form", autocomplete = "off" }))
            {
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdOrganization" class="left-col control-label">Organization Name</label>
                                <div class="right-col">
                                    @Html.HiddenFor(model => model.OrganizationId)
                                    @Html.TextBoxFor(model => model.OrganizationName, new { @class = "form-control", @placeholder = "ABC Ltd.", @name = "NmOrganization" })
                                    <span class="ibserror" id="Err_OrganizationName">Organization Name is required.</span>
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label class="left-col control-label">Organization Mode</label>
                                <div class="right-col">
                                    <div class="ibs-pos-rel">
                                        <select class="full-width" data-init-plugin="select2" name="cboMode" id="cboOrganizationMode">
                                            <option value="" @(ViewBag.cboMode == "" ? "selected" : String.Empty)> >> Select Item</option>
                                            <option value="0" @(ViewBag.cboMode == "0" ? "selected" : String.Empty)>NGO</option>
                                            <option value="1" @(ViewBag.cboMode == "1" ? "selected" : String.Empty)>Goverrment</option>
                                            <option value="2" @(ViewBag.cboMode == "2" ? "selected" : String.Empty)>Private</option>
                                            <option value="3" @(ViewBag.cboMode == "3" ? "selected" : String.Empty)>Public</option>
                                            <option value="4" @(ViewBag.cboMode == "4" ? "selected" : String.Empty)>Public Ltd</option>
                                        </select>
                                    </div>
                                    <span class="ibserror" id="Err_OrganizationMode">Organization Mode is required.</span>
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdContactPerson" class="left-col control-label">Contact Person</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.RegisteredPerson, new { @class = "form-control", @placeholder = "John Smith", @name = "NmContactPerson" })
                                </div>
                            </div>
                            <div class="clr"></div>
                        </div>
                    </div>


                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdPhone" class="left-col control-label">Phone</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.Phone, new { @class = "form-control", @placeholder = "+88 00000 000000", @name = "NmPhone" })
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdCountry" class="left-col control-label">Country</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.Country, new { @class = "form-control", @placeholder = "Bangladesh", @name = "NmCountry" })
                                    <span class="ibserror" id="Err_Country">Country is required.</span>
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdCity" class="left-col control-label">City</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.City, new { @class = "form-control", @placeholder = "Dhaka", @name = "NmCity" })
                                    <span class="ibserror" id="Err_City">City is required.</span>
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdPostCode" class="left-col control-label">Post Code</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.PosTCode, new { @class = "form-control", @placeholder = "1212", @name = "NmPostCode" })
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdEmail" class="left-col control-label">Email</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.Email, new { @class = "form-control", @placeholder = "johnsmith@gmail.com", @name = "NmPostCode", email = "email" })
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdWeb" class="left-col control-label">Web</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.Web, new { @class = "form-control", @placeholder = "www.invoguesoft.com", @name = "NmWeb" })
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdFax" class="left-col control-label">Fax</label>
                                <div class="right-col">
                                    @Html.TextBoxFor(model => model.Fax, new { @class = "form-control", @placeholder = "Fax", @name = "NmFax" })
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 frm-manage-pad1 xl-mb30">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdAddress" class="left-col control-label">Address</label>
                                <div class="right-col">
                                    @Html.TextAreaFor(model => model.OrganizationAddress, new { @class = "form-control", @placeholder = "Gulshan 1,Dhaka", @name = "NmFax" })
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>

                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 frm-manage-pad2">
                        <div class="form-group">
                            <div class="form-inner13">
                                <label for="IdLogo" class="left-col control-label">Logo</label>
                                <div class="right-col">
                                    <div class="ibs-pos-rel">
                                        @Html.TextBoxFor(model => model.OrganizationLogo, new { type = "file" })
                                    </div>
                                    <span class="ibserror" id="Err_Logo">Organization Logo is required.</span>

                                    @if (Model.OrganizationLogo != null)
                                    {
                                        var base64 = Convert.ToBase64String(Model.OrganizationLogo);
                                        var imgSrc = String.Format("data:image/gif;base64,{0}", base64);
                                            <img class="" src="@imgSrc" alt="" style="width:70px;height:50px;" />
                                    }  
                                </div>
                                <div class="clr"></div>
                            </div>
                            <div class="form-inner13">
                                <label for="fname" class="left-col control-label"></label>
                                <div class="right-col mt-org1">
                                    <button id="btnSave" class="btn btn-success custom-btn1" name="@ViewBag.BtnOrgSave" type="button">@ViewBag.TxtOrgSave</button>
                                </div>
                                <div class="clr"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            
                        </div>
                    </div>
                </div> 

            }

        </div>
    </div>
</div>

@section section_footer
{

  <script src="~/Content/built_in/assets/plugins/bootstrap-select2/select2.min.js"></script>
<script src="~/Content/built_in/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

<script>
    $(document).ready(function () {

        $("#btnSave").on('click', function () {
            if (IsFrmValid()) {
                var organizationInfo = {
                    OrganizationId: $('#OrganizationId').val() == "" ? 0 : $('#OrganizationId').val(),
                    OrganizationName: $('#OrganizationName').val(),
                    RegisteredPerson: $('#RegisteredPerson').val(),
                    OrganizationMode: $('#cboOrganizationMode').val(),
                    OrganizationAddress: $('#OrganizationAddress').val(),
                    PosTCode: $('#PosTCode').val(),
                    City: $('#City').val(),
                    Country: $('#Country').val(),
                    Phone: $('#Phone').val(),
                    Fax: $('#Fax').val(),
                    Email: $('#Email').val(),
                   // OrganizationLogo: $('#OrganizationLogo').val(),
                    Web: $('#Web').val()
                }

                var formdata = new FormData(); //FormData object
                var picFiles = $("#OrganizationLogo").get(0).files;
                if (picFiles.length > 0) {
                    
                    formdata.append('PicUploadFile', picFiles[0]);
                }
                formdata.append('fileInfo', JSON.stringify(organizationInfo));

                //if (picFiles.length > 0) {
                //    formdata.append('PicUploadFile', picFiles[0]);
                //}
                //formdata.append('fileInfo', JSON.stringify(organizationInfo));
                $.ajax({
                    url: '@Url.Action("FxOrganizationSave", "mstr_basic")',
                    data: formdata,
                   // dataType: "json",
                    type: "POST",
                    contentType: false,
                   
                   // async: false,
                    processData: false,
                   // cache: false,
                    success: function (data) {
                        if (data.isCompleted == true) { 
                            $('#OrganizationId').val(data.OrganizationId); 

                            if ($("#btnSave").html() == "Submit") {
                                ShowOpMessage("Submit", true, "");
                                $('.jqiclose').html('');

                                $("#btnSave").html("Save");
                            }
                            else {
                                ShowOpMessage("Save", true, "");
                                $('.jqiclose').html('');
                            }
                        }
                        else
                        {
                            $.each(data.Errors, function (key) {
                                if (data.Errors[key].Value != null) {
                                    $("#Err_" + data.Errors[key].Key).show();
                                    $("#Err_" + data.Errors[key].Key).html(data.Errors[key].Value);
                                }
                            });
                        }
                    },
                    error: function (xhr) {
                        ShowMessageBox_OK("Save operation information failed.", "Error", ""); 
                    }
                });
            }
        });
    });

   

    //function clearField(v) {
    //    if (v) {
    //        $('#OrganizationId').val('');
    //        $('#OrganizationName').val('');
    //        $('#RegisteredPerson').val('');
    //        $('#cboOrganizationMode').select2('val',''),
    //        $('#OrganizationAddress').val('');
    //        $('#PosTCode').val('');
    //        $('#City').val('');
    //        $('#Country').val('');
    //        $('#Phone').val('');
    //        $('#Fax').val('');
    //        $('#Email').val('');
    //        $('#OrganizationLogo').val('');
    //        $('#Web').val('');
    //        $("#btnSubmit");
    //        $("#btnVsbSave");
    //        $(".ibserror").hide();
    //        window.history.pushState("", "", "/Master/mstr_basic/frmorganization");
    //    }
    //}

    function IsFrmValid() {
        var isValidItem = true;
        if ($('#OrganizationName').val() == '') {
            isValidItem = false;
            $('#Err_OrganizationName').show();
        }
        else {
            $('#Err_OrganizationName').hide();
        }
        if ($('#cboOrganizationMode').val() == '') {
            isValidItem = false;
            $('#Err_OrganizationMode').show();
        }
        else {
            $('#Err_OrganizationMode').hide();
        }
        if ($('#City').val() == '') {
            isValidItem = false;
            $('#Err_City').show();
        }
        else {
            $('#Err_City').hide();
        }
        if ($('#Country').val() == '') {
            isValidItem = false;
            $('#Err_Country').show();
        }
        else {
            $('#Err_Country').hide();
        }       
        return isValidItem;
    }

    $('#OrganizationLogo').bind('change', function () {
        var ext = $(this).val().split(".");
        ext = ext[ext.length - 1].toLowerCase();
        var arrayExtensions = ["jpg", "jpeg", "png"];

        if (arrayExtensions.lastIndexOf(ext) == -1) {
            ShowMessageBox_OK("Allowed image formats are: " + arrayExtensions.join(', '), "Not Allowed", "");
            this.value = null;//reset file upload control
        }
        else {
            if (this.files[0].size > 307200 || this.files[0].fileSize > 307200) {
                ShowMessageBox_OK("Allowed file size exceeded. (Max. 300KB)", "Not Allowed", "");
                this.value = null;//reset file upload control
            }
        }
    });
</script>



 
}